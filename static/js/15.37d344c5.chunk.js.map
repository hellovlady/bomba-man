{"version":3,"sources":["routes/pages/Instructions.tsx","animations.tsx","utils/index.ts","containers/Game/components/TileIcon.tsx","containers/RoomCreator/icons.tsx","containers/Game/components/DeadCharacter.tsx","containers/Game/components/PowerUp/icons.tsx","containers/Game/components/SpriteCharacter.tsx","containers/Game/components/character-shadow.png","containers/Game/components/character-skin-default.png","containers/RoomCreator/utils.tsx","utils/material-ui.ts","hooks/useInterval.tsx","hooks/usePrevious.tsx","utils/npc.ts","store/redux/hooks/usePlayerEvents.tsx","components/Container/Container.tsx"],"names":["KeyboardIcon","props","icon","faKeyboard","KeyboardIconWrapper","styled","Container","$length","$size","$isPressed","theme","palette","background","primary","SquareIcon","children","size","length","isPressed","KeyboardSetupContainer","keyboardConfig","DropBomb","MoveDown","MoveLeft","MoveRight","MoveUp","bombKeyLength","label","useState","keyMap","setKeyMap","useKeyboardEvent","onKeyDown","keyEventCode","v","onKeyUp","container","style","width","item","xs","justify","keyCode","map","alignItems","PlayerSetupContainer","playerId","side","isLeft","playerIdIndex","Number","replace","order","name","id","showName","isWalking","isNPC","gameConfig","Instructions","overflow","spacing","KeyCode","bounceAnimation","withOpacity","keyframes","ghostAnimation","color","Math","ceil","sleep","duration","Promise","r","setTimeout","wrapPreventFocusLock","cb","e","currentTarget","blur","doesNotExist","value","undefined","findEnumKeyFromValue","enumerable","key","Object","keys","values","indexOf","TileIcon","div","$animationDelay","$top","$left","css","PowerUpIcon","faFistRaised","CubeIcon","faCube","MapIcon","faTh","FireIcon","faFire","faSquare","UserIcon","faUser","RobotIcon","faRobot","GhostIcon","faGhost","CharacterWrapper","$showName","$color","CharacterIcon","rest","coordinates","top","left","ICON_STYLE","fontSize","powerUpIconPack","generateIconPackFromPowerUps","DeadIcon","faBookDead","DeadCharacter","explodingDuration","onDeathAnimationComplete","useEffect","default","icons","PowerUp","Life","success","faHeart","BombCount","error","faBomb","BombSize","warning","faPrescriptionBottleAlt","MovementSpeed","info","faShoePrints","Wrapper","$name","pixelMultiplier","spriteSize","spriteSheetSize","spriteSheetSquareSize","translateDiff","topDiff","min","labelFontSize","labelTopDiff","floor","labelMaxWidth","spriteSizing","spriteSheetSizing","useSpriteCharacterAction","shouldBindEvent","onPlayerIsWalking","setDirection","setIsWalking","lastMovementTime","useRef","Date","getTime","handleKeyDown","newDirection","getMoveDirectionFromKeyboardCode","code","getDirection","current","updateDirection","handleKeyUp","delayedCurrentTime","document","addEventListener","removeEventListener","SpriteCharacter","currentOnlinePlayerId","highlight","defaultIsWalking","direction","defaultDirection","Direction","DOWN","eventDirection","setEventDirection","eventIsWalking","setEventIsWalking","className","data-facing","data-walking","toString","data-highlight","src","alt","iconStyle","reduce","acc","powerUpIcons","Icon","generatePowerUpSection","max","movementStops","powerUp","type","FormComponent","Rating","Slider","step","marks","generateMarks","minOrStops","maxOrNull","Array","isArray","diff","fill","_","ind","useInterval","callback","delay","shouldStop","savedCallback","clearLastInterval","useCallback","clearInterval","triggerCb","setInterval","usePrevious","ref","window","NPC_DEBUG","Store","NPCScore","log","console","filter","Boolean","isDifferentSquare","newCoordinates","oldCoordinates","newYSquare","ySquare","newXSquare","xSquare","oldYSquare","oldXSquare","isSquareAPossibleFire","currentSquareCoordinates","bombs","_fireCoordinates","forEach","players","coordinatesToSetOnFire","getExplosionResults","gameMap","state","getPoweredUpValue","powerUpConfig","defaults","sizes","flat","squareCoordinates","push","findIndex","fireSquareCoordinates","isAdjacent","dropBombAndRunOrScoreTarget","targetScore","runScore","currentTime","lastBombTime","bombDuration","dropBomb","generateScore","level","isSquareOutOfBoundaries","square","newSquare","IsPossibleFireExit","IsDanger","includes","IsPowerUp","IsStuck","Tile","Empty","IsEmptyTile","Player","score","IsPlayer","Breaking","IsBreakingTile","NonBreaking","IsNonBreakingTile","IsNonAdjacentNonBreakingTile","generateMovementTree","parentId","playerMovementTree","_newYSquare","_newXSquare","LEFT","UP","RIGHT","hasChildren","findNodeWithHighestScore","movementNodes","retVal","getRandomInt","groupMovementNodesByParentId","movementNodesGroupedById","movementNode","movementNodeParentId","getTotalScoreOfAllNodes","movementTree","validMovementNodes","movementNodesGroupedByParentId","entries","groupParentId","_groupParentId","nodeWithHighestScore","parentNodes","some","parentNode","findBestMove","currentCoordinates","usePlayerRefs","playerRefs","P1","getElementById","P2","P3","P4","recalculate","useTimeOutRef","useCanMove","timeOutRef","npc","npcState","newTime","movementSpeed","handleKeyEvent","isKeyDown","CODE_SPACE","preventDefault","registerKeys","canPlayerTakeAction","player","isPlayerDead","usePlayerInterval","playerActionSpeedOrNull","useMemo","playerState","usePlayerActionSpeed","MAX_SAFE_INTEGER","handleBombForPlayers","mapAllPossibleKeyboardKeysForAction","IntervalWrapper","usePlayerEvents","provider","gameType","triggerMove","is3D","config","powerUps","bomb","_players","GameType","Local","handleActions","previousIs3D","canMove","move","playerKeyboardConfig","directions","getMoveDirectionFromKeyMap","useEvents","handleNpcActions","pId","currentPlayer","getSquareCoordinatesFromSquareOrTopLeftCoordinates","movement","bestMovementNode","npcAction"],"mappings":"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","file":"static/js/15.37d344c5.chunk.js","sourcesContent":["import gameConfig from 'config';\nimport PageContainer from 'components/PageContainer';\nimport { faKeyboard } from '@fortawesome/free-solid-svg-icons';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport {\n\tFontAwesomeIconProps,\n\tKeyboardEventCode,\n\tKeyMap,\n\tPlayerActionKeys,\n\tPlayerId,\n} from 'containers/Game/types';\nimport { H1, H4 } from 'components/typography';\nimport { Grid } from '@material-ui/core';\nimport Container from 'components/Container';\nimport styled from 'styled-components';\nimport { CharacterIcon } from 'containers/RoomCreator/icons';\nimport Spacer from 'components/Spacer';\nimport theme from 'theme';\nimport * as KeyCode from 'keycode-js';\nimport { useKeyboardEvent } from 'store/redux/hooks/usePlayerEvents';\nimport { useState } from 'react';\n\nconst KeyboardIcon = (props: FontAwesomeIconProps) => (\n\t<FontAwesomeIcon icon={faKeyboard} {...props} />\n);\n\ntype IsPressed = { isPressed?: boolean };\n\nconst KeyboardIconWrapper = styled(Container)<\n\tStyledProps<Required<SquareIconProps> & IsPressed>\n>`\n\tborder: 2px solid;\n\tborder-radius: 4px;\n\tpadding: 10px;\n\tfont-weight: bold;\n\theight: 45px;\n\ttransition: 0.3s;\n\n\t${({ $length, $size, $isPressed }) => {\n\t\treturn `\n\t\t\theight: ${$size}px;\n\t\t\twidth: ${$size * $length}px;\n\t\t\t${\n\t\t\t\t$isPressed\n\t\t\t\t\t? `\n\t\t\t\t\t\tbackground: white;\n\t\t\t\t\t\tcolor: ${theme.palette.background.primary};\n\t\t\t\t\t\tborder: 2px dashed ${theme.palette.background.primary};\n\t\t\t\t`\n\t\t\t\t\t: ''\n\t\t\t}\n\t\t`;\n\t}}\n`;\n\ninterface SquareIconProps {\n\tsize?: number;\n\tlength?: number;\n}\n\nconst SquareIcon: React.FC<SquareIconProps & IsPressed> = ({\n\tchildren,\n\tsize = 45,\n\tlength = 1,\n\tisPressed,\n}) => (\n\t<KeyboardIconWrapper $length={length} $size={size} $isPressed={isPressed}>\n\t\t{children}\n\t</KeyboardIconWrapper>\n);\n\ninterface KeyboardSetupContainerProps {\n\tkeyboardConfig: Record<\n\t\tPlayerActionKeys,\n\t\t{\n\t\t\tlabel: string;\n\t\t\tkeyCode: KeyboardEventCode;\n\t\t}\n\t>;\n}\n\nconst KeyboardSetupContainer = ({\n\tkeyboardConfig,\n}: KeyboardSetupContainerProps) => {\n\tconst { DropBomb, MoveDown, MoveLeft, MoveRight, MoveUp } = keyboardConfig;\n\tconst bombKeyLength = DropBomb.label.length > 1 ? 3 : 1;\n\n\tconst [keyMap, setKeyMap] = useState<KeyMap>({});\n\tuseKeyboardEvent({\n\t\tonKeyDown: keyEventCode => {\n\t\t\tsetKeyMap(v => ({\n\t\t\t\t...v,\n\t\t\t\t[keyEventCode]: true,\n\t\t\t}));\n\t\t},\n\t\tonKeyUp: keyEventCode => {\n\t\t\tsetKeyMap(v => ({\n\t\t\t\t...v,\n\t\t\t\t[keyEventCode]: false,\n\t\t\t}));\n\t\t},\n\t});\n\n\treturn (\n\t\t<Grid container>\n\t\t\t<Grid container style={{ width: 45 * 3 }}>\n\t\t\t\t<Grid container item xs={12} justify=\"center\">\n\t\t\t\t\t<SquareIcon isPressed={keyMap[MoveUp.keyCode]}>\n\t\t\t\t\t\t{MoveUp.label}\n\t\t\t\t\t</SquareIcon>\n\t\t\t\t</Grid>\n\t\t\t\t<Grid container item xs={12}>\n\t\t\t\t\t{[MoveLeft, MoveDown, MoveRight].map(\n\t\t\t\t\t\t({ label, keyCode }) => (\n\t\t\t\t\t\t\t<SquareIcon\n\t\t\t\t\t\t\t\tisPressed={keyMap[keyCode as KeyboardEventCode]}\n\t\t\t\t\t\t\t\tkey={label}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{label}\n\t\t\t\t\t\t\t</SquareIcon>\n\t\t\t\t\t\t)\n\t\t\t\t\t)}\n\t\t\t\t</Grid>\n\t\t\t</Grid>\n\t\t\t<Grid style={{ width: 10 }} />\n\t\t\t<Grid\n\t\t\t\tcontainer\n\t\t\t\tstyle={{ width: 45 * 3 }}\n\t\t\t\tjustify=\"center\"\n\t\t\t\talignItems=\"flex-end\"\n\t\t\t>\n\t\t\t\t<SquareIcon\n\t\t\t\t\tisPressed={keyMap[DropBomb.keyCode]}\n\t\t\t\t\tlength={bombKeyLength}\n\t\t\t\t>\n\t\t\t\t\t{DropBomb.label}\n\t\t\t\t</SquareIcon>\n\t\t\t</Grid>\n\t\t</Grid>\n\t);\n};\n\ninterface PlayerSetupContainerProps extends KeyboardSetupContainerProps {\n\tside?: 'left' | 'right';\n\tplayerId: PlayerId;\n}\n\nconst PlayerSetupContainer = ({\n\tkeyboardConfig,\n\tplayerId,\n\tside = 'left',\n}: PlayerSetupContainerProps) => {\n\tconst isLeft = side === 'left';\n\n\tconst playerIdIndex = Number(playerId.replace('P', '')) - 1;\n\n\treturn (\n\t\t<Grid container xs={12} justify=\"center\">\n\t\t\t<Grid item {...(!isLeft && { style: { order: 3 } })}>\n\t\t\t\t<CharacterIcon\n\t\t\t\t\tsize={80}\n\t\t\t\t\tname={playerId}\n\t\t\t\t\tid={playerId}\n\t\t\t\t\tshowName\n\t\t\t\t\tisWalking\n\t\t\t\t\tisNPC={false}\n\t\t\t\t\tkeyboardConfig={{\n\t\t\t\t\t\t'0': gameConfig.keyboardConfig[playerIdIndex],\n\t\t\t\t\t}}\n\t\t\t\t/>\n\t\t\t</Grid>\n\t\t\t<Grid item>\n\t\t\t\t<KeyboardSetupContainer keyboardConfig={keyboardConfig} />\n\t\t\t</Grid>\n\t\t</Grid>\n\t);\n};\n\nconst Instructions = () => {\n\treturn (\n\t\t<PageContainer style={{ overflow: 'hidden' }}>\n\t\t\t<Grid container justify=\"center\" alignItems=\"center\">\n\t\t\t\t<KeyboardIcon size=\"3x\" /> &nbsp;&nbsp;\n\t\t\t\t<H1> Instructions </H1>\n\t\t\t\t<H4 style={{ width: '100%' }}>\n\t\t\t\t\tNOTE: In an online game, you can use both setup\n\t\t\t\t</H4>\n\t\t\t\t<H4 style={{ width: '100%' }}>\n\t\t\t\t\tNOTE2: You can test the keys on this screen :)\n\t\t\t\t</H4>\n\t\t\t</Grid>\n\t\t\t<Spacer spacing=\"10\" />\n\t\t\t<PlayerSetupContainer\n\t\t\t\tplayerId=\"P1\"\n\t\t\t\tkeyboardConfig={{\n\t\t\t\t\tMoveUp: {\n\t\t\t\t\t\tlabel: 'W',\n\t\t\t\t\t\tkeyCode: KeyCode.CODE_W,\n\t\t\t\t\t},\n\t\t\t\t\tMoveRight: {\n\t\t\t\t\t\tlabel: 'D',\n\t\t\t\t\t\tkeyCode: KeyCode.CODE_D,\n\t\t\t\t\t},\n\t\t\t\t\tMoveDown: {\n\t\t\t\t\t\tlabel: 'S',\n\t\t\t\t\t\tkeyCode: KeyCode.CODE_S,\n\t\t\t\t\t},\n\t\t\t\t\tMoveLeft: {\n\t\t\t\t\t\tlabel: 'A',\n\t\t\t\t\t\tkeyCode: KeyCode.CODE_A,\n\t\t\t\t\t},\n\t\t\t\t\tDropBomb: {\n\t\t\t\t\t\tlabel: 'Space',\n\t\t\t\t\t\tkeyCode: KeyCode.CODE_SPACE,\n\t\t\t\t\t},\n\t\t\t\t}}\n\t\t\t/>\n\t\t\t<Spacer spacing=\"10\" />\n\t\t\t<PlayerSetupContainer\n\t\t\t\tplayerId=\"P2\"\n\t\t\t\tkeyboardConfig={{\n\t\t\t\t\tMoveUp: {\n\t\t\t\t\t\tlabel: '↑',\n\t\t\t\t\t\tkeyCode: KeyCode.CODE_UP,\n\t\t\t\t\t},\n\t\t\t\t\tMoveRight: {\n\t\t\t\t\t\tlabel: '→',\n\t\t\t\t\t\tkeyCode: KeyCode.CODE_RIGHT,\n\t\t\t\t\t},\n\t\t\t\t\tMoveDown: {\n\t\t\t\t\t\tlabel: ' ↓',\n\t\t\t\t\t\tkeyCode: KeyCode.CODE_DOWN,\n\t\t\t\t\t},\n\t\t\t\t\tMoveLeft: {\n\t\t\t\t\t\tlabel: '←',\n\t\t\t\t\t\tkeyCode: KeyCode.CODE_LEFT,\n\t\t\t\t\t},\n\t\t\t\t\tDropBomb: {\n\t\t\t\t\t\tlabel: ';',\n\t\t\t\t\t\tkeyCode: KeyCode.CODE_SEMICOLON,\n\t\t\t\t\t},\n\t\t\t\t}}\n\t\t\t\tside=\"right\"\n\t\t\t/>\n\t\t</PageContainer>\n\t);\n};\n\nexport default Instructions;\n","import { keyframes } from 'styled-components';\n\n/** @see https://codepen.io/nelledejones/pen/gOOPWrK#L68 */\nconst bounceAnimation = (withOpacity = false) => keyframes`\n\t0% { transform: scale(0, 0); }\n\t25% { transform: scale(0.9, 1.1); }\n\t50% { transform: scale(1.1, 0.9); }\n\t75% { transform: scale(0.95, 1.05); }\n\t100% { transform: scale(1, 1); ${(withOpacity && 'opacity: 1;') || ''} }\n`;\n\nconst ghostAnimation = (size: number, color: string) => keyframes`\n\t0%, 100% { \n\t\ttransform: translateY(0px); \n\t\tbox-shadow: 0 10px 10px #000000;\n\t}\n\t50% {\n\t\ttransform: translateY(-10px);\n\t\tbox-shadow: 0 20px ${Math.ceil(size / 6) + 10}px ${color};\n\t}\n`;\n\nexport { bounceAnimation, ghostAnimation };\n","const sleep = (duration = 1000) => {\n\treturn new Promise(r => {\n\t\tsetTimeout(r, duration);\n\t});\n};\n\n/**\n * Wraps the button on click with a blur event to undo auto on focus. This is\n * especially annoying when view is changed and the user hits the \"Space\"\n * button and it switches the view back as it's \"focus\"ed on.\n *\n * @param cb Curried function where callback is wrapped with this utility.\n * @returns Base event cb\n */\nconst wrapPreventFocusLock = (\n\tcb: (e: React.MouseEvent<HTMLButtonElement, MouseEvent>) => void\n) => (e: React.MouseEvent<HTMLButtonElement, MouseEvent>) => {\n\t// undo onFocus lock\n\te.currentTarget.blur();\n\tcb(e);\n};\n\nconst doesNotExist = (value: any) => value === null || value === undefined;\n\nconst findEnumKeyFromValue = (enumerable: object, key: string) => {\n\treturn Object.keys(enumerable)[Object.values(enumerable).indexOf(key)];\n};\n\nexport { sleep, wrapPreventFocusLock, doesNotExist, findEnumKeyFromValue };\n","import { bounceAnimation } from 'animations';\nimport styled, { css } from 'styled-components';\n\nconst TileIcon = styled.div<{\n\t$size: number;\n\t$top: number;\n\t$left: number;\n\t$animationDelay?: string;\n}>`\n\tposition: absolute;\n\tdisplay: flex;\n\tjustify-content: center;\n\talign-items: center;\n\topacity: 0;\n\tsvg {\n\t\theight: 100% !important;\n\t\twidth: 100% !important;\n\t\tmax-width: 70%;\n\t\tmax-height: 80%;\n\t}\n\t${({ $size, $animationDelay, $top, $left }) => css`\n\t\ttop: ${$top}px;\n\t\tleft: ${$left}px;\n\t\twidth: ${$size}px;\n\t\theight: ${$size}px;\n\t\tanimation: ${bounceAnimation(true)} var(--block-animation-duration)\n\t\t\t${$animationDelay || ''} ease-out forwards;\n\t`}\n`;\n\nexport default TileIcon;\n","import {\n\tfaFistRaised,\n\tfaCube,\n\tfaTh,\n\tfaSquare,\n\tfaFire,\n\tfaUser,\n\tfaRobot,\n\tfaGhost,\n} from '@fortawesome/free-solid-svg-icons';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport DeadCharacter from 'containers/Game/components/DeadCharacter';\nimport SpriteCharacter, {\n\tSpriteCharacterProps,\n} from 'containers/Game/components/SpriteCharacter';\nimport { FontAwesomeIconProps } from 'containers/Game/types';\nimport styled from 'styled-components';\nimport { generateIconPackFromPowerUps } from './utils';\n\nconst PowerUpIcon = (props: FontAwesomeIconProps) => (\n\t<FontAwesomeIcon icon={faFistRaised} {...props} />\n);\n\nconst CubeIcon = (props: FontAwesomeIconProps) => (\n\t<FontAwesomeIcon icon={faCube} {...props} />\n);\n\nconst MapIcon = (props: FontAwesomeIconProps) => (\n\t<FontAwesomeIcon icon={faTh} {...props} />\n);\n\nconst FireIcon = (props: FontAwesomeIconProps) => (\n\t<FontAwesomeIcon icon={faFire} {...props} />\n);\n\nconst SquareIcon = (props: FontAwesomeIconProps) => (\n\t<FontAwesomeIcon icon={faSquare} {...props} />\n);\n\nconst UserIcon = (props: FontAwesomeIconProps) => (\n\t<FontAwesomeIcon icon={faUser} {...props} />\n);\n\nconst RobotIcon = (props: FontAwesomeIconProps) => (\n\t<FontAwesomeIcon icon={faRobot} {...props} />\n);\n\nconst GhostIcon = (props: FontAwesomeIconProps) => (\n\t<FontAwesomeIcon icon={faGhost} {...props} />\n);\n\nconst CharacterWrapper = styled.div<\n\tStyledProps<CharacterIconProps, 'size' | 'showName' | 'color'>\n>`\n\tposition: relative;\n\tpointer-events: none;\n\tmin-width: 50px;\n\n\t${({ $showName, $color }) => {\n\t\treturn `\n\t\t\t.name {\n\t\t\t\t${!$showName ? 'display: none;' : ''}\n\t\t\t\t${$color ? `background-color: ${$color} !important;` : ''}\n\t\t\t\t\n\t\t\t}\n\t\t`;\n\t}}\n\n\t${({ $size }) => {\n\t\treturn `\n\t\t\twidth: ${$size}px;\n\t\t\theight: ${$size}px;\n\n\t\t\t> div {\n\t\t\t\t/* Gotta override as char is taking coordinates by default */\n\t\t\t\ttop: ${$size / 2}px !important;\n\t\t\t\tleft: calc(50% - ${$size}px / 2) !important;\n\t\t\t}\n\t\t`;\n\t}}\n`;\n\ninterface CharacterIconProps extends Partial<SpriteCharacterProps> {\n\tsize: SpriteCharacterProps['size'];\n\tcolor?: string;\n\tshowName?: boolean;\n}\n\nconst CharacterIcon = ({\n\tsize,\n\tshowName = false,\n\tcolor,\n\t...rest\n}: CharacterIconProps) => {\n\treturn (\n\t\t<CharacterWrapper $size={size} $showName={showName} $color={color}>\n\t\t\t<SpriteCharacter\n\t\t\t\tcoordinates={{ top: 0, left: 0 }}\n\t\t\t\tid=\"P1\"\n\t\t\t\tname=\"Bomba-man\"\n\t\t\t\tisNPC\n\t\t\t\tsize={size}\n\t\t\t\t{...rest}\n\t\t\t/>\n\t\t</CharacterWrapper>\n\t);\n};\n\nconst DeadCharacterIcon = ({\n\tsize,\n\tshowName = false,\n\t...rest\n}: CharacterIconProps) => {\n\treturn (\n\t\t<CharacterWrapper $size={size} $showName={showName}>\n\t\t\t<DeadCharacter\n\t\t\t\tcoordinates={{ top: 0, left: 0 }}\n\t\t\t\tid=\"P1\"\n\t\t\t\tname=\"Bomba-man\"\n\t\t\t\texplodingDuration={0 as any}\n\t\t\t\tsize={size}\n\t\t\t\t{...rest}\n\t\t\t/>\n\t\t</CharacterWrapper>\n\t);\n};\n\nconst ICON_STYLE = { fontSize: 40, width: 50 };\nconst powerUpIconPack = generateIconPackFromPowerUps(ICON_STYLE);\n\nexport type { CharacterIconProps };\nexport {\n\tPowerUpIcon,\n\tCubeIcon,\n\tMapIcon,\n\tFireIcon,\n\tSquareIcon,\n\tUserIcon,\n\tRobotIcon,\n\tGhostIcon,\n\tCharacterIcon,\n\tDeadCharacterIcon,\n\tpowerUpIconPack,\n\tICON_STYLE,\n};\n","import { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { faBookDead } from '@fortawesome/free-solid-svg-icons';\nimport {\n\tFontAwesomeIconProps,\n\tPlayerId,\n\tTopLeftCoordinates,\n} from 'containers/Game/types';\nimport theme from 'theme';\nimport { GameConfigRanges } from 'store/redux/reducers/game/types';\nimport { useEffect } from 'react';\nimport TileIcon from './TileIcon';\nimport { SpriteCharacterProps } from './SpriteCharacter';\n\nconst DeadIcon = (props: FontAwesomeIconProps) => (\n\t<FontAwesomeIcon icon={faBookDead} {...props} />\n);\n\ninterface Props extends Omit<SpriteCharacterProps, 'onPlayerIsWalking'> {\n\texplodingDuration: GameConfigRanges.ExplodingDuration;\n\tcoordinates: TopLeftCoordinates;\n\tonDeathAnimationComplete?: (playerId: PlayerId) => void;\n}\n\nconst DeadCharacter = ({\n\tid,\n\t// name,\n\tsize,\n\texplodingDuration,\n\tcoordinates: { top, left },\n\tonDeathAnimationComplete,\n}: Props) => {\n\tuseEffect(() => {\n\t\tsetTimeout(() => {\n\t\t\tonDeathAnimationComplete?.(id);\n\t\t}, explodingDuration * 1000 + 1000);\n\t\t// eslint-disable-next-line react-hooks/exhaustive-deps\n\t}, []);\n\treturn (\n\t\t<TileIcon\n\t\t\t$top={top}\n\t\t\t$left={left}\n\t\t\t$size={size}\n\t\t\t$animationDelay={`${explodingDuration}s`}\n\t\t>\n\t\t\t<DeadIcon color={theme.palette.color.default} />\n\t\t\t{/* <div className=\"name\">{name}</div> */}\n\t\t</TileIcon>\n\t);\n};\n\nexport default DeadCharacter;\n","import { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport {\n\tfaShoePrints,\n\tfaHeart,\n\tfaBomb,\n\tfaPrescriptionBottleAlt,\n} from '@fortawesome/free-solid-svg-icons';\nimport { PowerUp } from 'enums';\nimport theme from 'theme';\nimport { FontAwesomeIconProps } from 'containers/Game/types';\n\nconst ShoePrintsIcon = (props: FontAwesomeIconProps) => (\n\t<FontAwesomeIcon icon={faShoePrints} {...props} />\n);\nconst HeartIcon = (props: FontAwesomeIconProps) => (\n\t<FontAwesomeIcon icon={faHeart} {...props} />\n);\nconst BombIcon = (props: FontAwesomeIconProps) => (\n\t<FontAwesomeIcon icon={faBomb} {...props} />\n);\nconst PrescriptionBottleAltIcon = (props: FontAwesomeIconProps) => (\n\t<FontAwesomeIcon icon={faPrescriptionBottleAlt} {...props} />\n);\n\nconst icons: Record<\n\tPowerUp,\n\t{ icon: (props: FontAwesomeIconProps) => JSX.Element; color: string }\n> = {\n\t[PowerUp.Life]: {\n\t\tcolor: theme.palette.color.success,\n\t\ticon: HeartIcon,\n\t},\n\t[PowerUp.BombCount]: {\n\t\tcolor: theme.palette.color.error,\n\t\ticon: BombIcon,\n\t},\n\t[PowerUp.BombSize]: {\n\t\tcolor: theme.palette.color.warning,\n\t\ticon: PrescriptionBottleAltIcon,\n\t},\n\t[PowerUp.MovementSpeed]: {\n\t\tcolor: theme.palette.color.info,\n\t\ticon: ShoePrintsIcon,\n\t},\n};\n\nexport default icons;\n","import { Direction } from 'enums';\nimport { useEffect, useRef, useState } from 'react';\nimport { getMoveDirectionFromKeyboardCode } from 'utils/game';\nimport styled, { css } from 'styled-components';\nimport theme from 'theme';\nimport { CharacterProps } from './Character';\nimport './SpriteCharacter.scss';\nimport spriteShadow from './character-shadow.png';\nimport spriteImage from './character-skin-default.png';\n\nconst SPRITE_SQUARE_SIZE = 32;\nconst Wrapper = styled.div<{ $size: number; $name: string }>`\n\t${({ $size, $name }) => {\n\t\t// CALCULATED\n\t\tconst pixelMultiplier = $size / SPRITE_SQUARE_SIZE;\n\t\tconst spriteSize = pixelMultiplier * SPRITE_SQUARE_SIZE;\n\t\tconst spriteSheetSize = spriteSize * 4;\n\t\tconst spriteSheetSquareSize = pixelMultiplier * -1 * SPRITE_SQUARE_SIZE;\n\t\tconst translateDiff = ($size / 4) * -1;\n\t\tconst topDiff = Math.min(-15, translateDiff * 2.5);\n\t\tconst labelFontSize = Math.min(30, Math.ceil(spriteSize / 6));\n\t\tconst labelTopDiff = Math.floor(spriteSize / (5 * 2));\n\t\t// const labelMaxWidth = Math.ceil(spriteSize * 0.8);\n\t\tconst labelMaxWidth = Math.floor(\n\t\t\t$name.length * 20 + (spriteSize * pixelMultiplier) / 10\n\t\t);\n\n\t\tconst spriteSizing = `\n\t\t\twidth: ${spriteSize}px;\n\t\t\theight: ${spriteSize}px;\n\t\t`;\n\t\tconst spriteSheetSizing = `\n\t\t\twidth: ${spriteSheetSize}px;\n\t\t\theight: ${spriteSheetSize}px;\n\t\t`;\n\n\t\treturn css`\n\t\t\tposition: absolute;\n\t\t\tz-index: 9999;\n\t\t\t${spriteSizing};\n\t\t\ttransition-duration: 450ms;\n\n\t\t\t&#P1 .name {\n\t\t\t\tbackground-color: ${theme.palette.color.warning};\n\t\t\t}\n\t\t\t&#P2 .name {\n\t\t\t\tbackground-color: ${theme.palette.color.info};\n\t\t\t}\n\t\t\t&#P3 .name {\n\t\t\t\tbackground-color: ${theme.palette.color.success};\n\t\t\t}\n\t\t\t&#P4 .name {\n\t\t\t\tbackground-color: ${theme.palette.color.error};\n\t\t\t}\n\n\t\t\t.character {\n\t\t\t\ttop: ${topDiff}px;\n\t\t\t\ttransform: translate(${translateDiff}px);\n\n\t\t\t\t${spriteSizing};\n\t\t\t\toverflow: hidden;\n\t\t\t\tposition: relative;\n\t\t\t\t/* MOVEMENT TRANSITION */\n\t\t\t\ttransition-duration: 400ms;\n\n\t\t\t\t& .name {\n\t\t\t\t\tposition: absolute;\n\t\t\t\t\tleft: 0;\n\t\t\t\t\tright: 0;\n\t\t\t\t\ttop: ${labelTopDiff}px;\n\t\t\t\t\tfont-size: ${labelFontSize}px;\n\t\t\t\t\tmax-width: ${labelMaxWidth}px;\n\t\t\t\t\tfont-weight: bold;\n\t\t\t\t\tborder: 1px dashed white;\n\t\t\t\t\tborder-radius: 9999px;\n\t\t\t\t\topacity: 1;\n\t\t\t\t\tmargin: auto;\n\t\t\t\t\ttext-align: center;\n\t\t\t\t}\n\n\t\t\t\t& .shadow {\n\t\t\t\t\t${spriteSizing};\n\t\t\t\t\topacity: 0.75;\n\t\t\t\t}\n\n\t\t\t\t& .spritesheet {\n\t\t\t\t\t${spriteSheetSizing};\n\t\t\t\t\tposition: absolute;\n\t\t\t\t\ttop: 0;\n\t\t\t\t\tleft: 0;\n\t\t\t\t}\n\n\t\t\t\t/* DIRECTION */\n\t\t\t\t&[data-facing='Right'] .spritesheet {\n\t\t\t\t\ttop: ${spriteSheetSquareSize * 1}px;\n\t\t\t\t}\n\t\t\t\t&[data-facing='Up'] .spritesheet {\n\t\t\t\t\ttop: ${spriteSheetSquareSize * 2}px;\n\t\t\t\t}\n\t\t\t\t&[data-facing='Left'] .spritesheet {\n\t\t\t\t\ttop: ${spriteSheetSquareSize * 3}px;\n\t\t\t\t}\n\n\t\t\t\t&[data-walking='true'] {\n\t\t\t\t\t/* MOVEMENT ANIMATION */\n\t\t\t\t\t.spritesheet {\n\t\t\t\t\t\tanimation: walkAnimation 0.6s steps(4) infinite;\n\t\t\t\t\t}\n\n\t\t\t\t\t/* SHADOW ANIMATION */\n\t\t\t\t\t.shadow {\n\t\t\t\t\t\tanimation: shadowAnimation 0.3s infinite;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t/* HIGHLIGHT/DAMAGE ANIMATION */\n\t\t\t\t&[data-highlight='true'] .spritesheet {\n\t\t\t\t\tanimation: opacityAnimation 0.6s steps(4) infinite;\n\t\t\t\t}\n\t\t\t}\n\t\t`;\n\t}}\n`;\n\nconst ANIMATION_STOP_THROTTLE_DURATION = 200;\n\ninterface Props extends Omit<CharacterProps, 'tileSize' | 'is3D' | 'size'> {\n\t// size can be any number by default, unless it's a game character\n\tsize: number;\n}\n\ntype UseSpriteCharacterAction = Omit<Props, 'coordinates' | 'name' | 'size'> & {\n\tshouldBindEvent: boolean;\n\t// setters\n\tsetDirection: React.Dispatch<React.SetStateAction<Direction>>;\n\tsetIsWalking: React.Dispatch<React.SetStateAction<boolean>>;\n};\n\nconst useSpriteCharacterAction = ({\n\tid,\n\tshouldBindEvent,\n\tkeyboardConfig,\n\t// state setter\n\tonPlayerIsWalking,\n\t// setters\n\tsetDirection,\n\tsetIsWalking,\n}: UseSpriteCharacterAction) => {\n\tconst lastMovementTime = useRef(new Date().getTime());\n\n\tuseEffect(() => {\n\t\t// ignore the npc action\n\t\tconst getDirection = (e: KeyboardEvent) => {\n\t\t\treturn keyboardConfig\n\t\t\t\t? getMoveDirectionFromKeyboardCode(e.code, keyboardConfig)\n\t\t\t\t: null;\n\t\t};\n\n\t\tconst updateDirection = (newDirection: Direction) => {\n\t\t\tsetDirection(newDirection);\n\t\t};\n\n\t\tconst handleKeyDown = (e: KeyboardEvent) => {\n\t\t\tif (!shouldBindEvent) return;\n\n\t\t\tconst newDirection = getDirection(e);\n\t\t\tif (!newDirection) {\n\t\t\t\tonPlayerIsWalking?.(false, id);\n\t\t\t\tsetIsWalking(false);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tlastMovementTime.current = new Date().getTime();\n\t\t\tsetIsWalking(true);\n\t\t\tupdateDirection(newDirection);\n\t\t};\n\n\t\tconst handleKeyUp = () => {\n\t\t\tif (!shouldBindEvent) return;\n\t\t\t// keypress-move: keydown + keyup, i.e. D, D, D (not hold D)\n\t\t\t// Only stop the moving animation after the player goes idle\n\t\t\t// for some duration. This allows us to use keypress to move\n\t\t\t// and still have a move animation (instead of keydown).\n\t\t\t// This is needed because otherwise keypress-move wont trigger\n\t\t\t// animations.\n\t\t\tsetTimeout(() => {\n\t\t\t\tconst delayedCurrentTime =\n\t\t\t\t\tnew Date().getTime() - ANIMATION_STOP_THROTTLE_DURATION;\n\t\t\t\tif (lastMovementTime.current >= delayedCurrentTime) return;\n\t\t\t\tsetIsWalking(false);\n\t\t\t\tonPlayerIsWalking?.(false, id);\n\t\t\t}, ANIMATION_STOP_THROTTLE_DURATION);\n\t\t};\n\n\t\t//\n\t\tif (shouldBindEvent) {\n\t\t\tdocument.addEventListener('keydown', handleKeyDown);\n\t\t\tdocument.addEventListener('keyup', handleKeyUp);\n\t\t}\n\t\treturn () => {\n\t\t\tdocument.removeEventListener('keydown', handleKeyDown);\n\t\t\tdocument.removeEventListener('keyup', handleKeyUp);\n\t\t};\n\t}, [\n\t\tid,\n\t\tkeyboardConfig,\n\t\tonPlayerIsWalking,\n\t\tsetDirection,\n\t\tsetIsWalking,\n\t\tshouldBindEvent,\n\t]);\n};\n\nconst SpriteCharacter = ({\n\tid,\n\tcurrentOnlinePlayerId,\n\tname,\n\tcoordinates: { top, left },\n\tstyle,\n\tkeyboardConfig,\n\thighlight,\n\tsize,\n\tonPlayerIsWalking,\n\tisWalking: defaultIsWalking = false,\n\tdirection: defaultDirection = Direction.DOWN,\n\tisNPC = false,\n\t...rest\n}: Props) => {\n\t/** Direction being faced */\n\tconst [eventDirection, setEventDirection] = useState<Direction>(\n\t\tdefaultDirection\n\t);\n\tconst [eventIsWalking, setEventIsWalking] = useState<boolean>(\n\t\tdefaultIsWalking\n\t);\n\n\t// We only want to bind the event if it's:\n\t// - not online game\n\t// - online game and it's the current player\n\tconst shouldBindEvent =\n\t\t!isNPC && (!currentOnlinePlayerId || id === currentOnlinePlayerId);\n\n\tuseSpriteCharacterAction({\n\t\tid,\n\t\tcurrentOnlinePlayerId,\n\t\tkeyboardConfig,\n\t\tshouldBindEvent,\n\t\t// state setter\n\t\tonPlayerIsWalking,\n\t\t// setters\n\t\tsetDirection: setEventDirection,\n\t\tsetIsWalking: setEventIsWalking,\n\t});\n\n\tlet isWalking = defaultIsWalking;\n\tlet direction = defaultDirection;\n\n\tif (shouldBindEvent) {\n\t\tisWalking = eventIsWalking;\n\t\tdirection = eventDirection;\n\t}\n\n\treturn (\n\t\t<Wrapper\n\t\t\tid={id}\n\t\t\tstyle={{\n\t\t\t\t...style,\n\t\t\t\ttop,\n\t\t\t\tleft,\n\t\t\t}}\n\t\t\tclassName=\"character-wrapper\"\n\t\t\t{...rest}\n\t\t\t$size={size * 2}\n\t\t\t$name={name}\n\t\t>\n\t\t\t<div\n\t\t\t\tclassName=\"character\"\n\t\t\t\tdata-facing={direction}\n\t\t\t\tdata-walking={isWalking.toString()}\n\t\t\t\tdata-highlight={highlight}\n\t\t\t>\n\t\t\t\t<div className=\"name\">{name}</div>\n\t\t\t\t<img\n\t\t\t\t\tclassName=\"shadow pixel-art\"\n\t\t\t\t\tsrc={spriteShadow}\n\t\t\t\t\talt=\"sprite skin\"\n\t\t\t\t/>\n\t\t\t\t<img\n\t\t\t\t\tclassName=\"spritesheet pixel-art\"\n\t\t\t\t\tsrc={spriteImage}\n\t\t\t\t\talt=\"sprite skin\"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</Wrapper>\n\t);\n};\n\nexport type { Props as SpriteCharacterProps };\nexport default SpriteCharacter;\n","export default \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAWUlEQVRYR+3XsQkAIAxEUe2cRXADx3cDwVksJYX970T41sE7Xqrk9Pjlx/nJAgoooIACCiiggAIKKKDAXwKt9k0uqblGIXMxgwVo+A2mJSyABYKWroHyx58Hv0cUIWfm8TkAAAAASUVORK5CYII=\"","export default \"data:image/png;base64,UklGRuYBAABXRUJQVlA4TNkBAAAvf8AfEDegkI0kaB1Wc63vv4M4DQUByDA6SKk4ex2mqG0bqCCKrfwp7N5em/8A4P9XnTtjLpKQBLi1tbdt/gbqnTCAN/D5RCygH6yhQ4C1GfefQQG/fjA4FhH9Z9i2bZjkAbZdhsAn0N9Qh3Rps6Tr7enSZ9lZ1PV+6bPsLO4q4Fj1ORugiqJzAdemHQCwqMszM8vOoq4wzXNrso4rVOW6YeXnwAFDfg66i/MBl3QOm5+DDrAmX0BjNK5QAfYsOYVzJHCjcr1VjGTyTmZhrj2PUeUKvuZIeWc7iQ6TdK4URIcJSXIQyS75V0Q70f+F9g48tFcs4Nq6A4Vd69w7RGdRF4UBhmRnWZd1wlhZB3tQuabj0JFQXb4+n2pMKlfoeHgRzhW9cK7ZcyKVa2Kehcn3SWRURueqkpdcSWIEE0jv+ne4d0DeKxZw7a5jV/aO4IDByDlGSZe/VvYc1dUpu+RzNrlqa+ZxyrtOPESNyzs+5s9FtbRGUT2mUeUKdapHZe4wkzZ3oH+muYNvAMjO8q5tO7CMS7MHeJRxrSt3gHsgVzBlXYOUG3QYOtK4yLpTq8oVqMX4dFDlEh+OrVHlConjTLpcgrklARpJcDYpKl0xNco1wgRTwLUPTQA=\"","import { PowerUp } from 'enums';\nimport powerUpIcons from 'containers/Game/components/PowerUp/icons';\nimport { findEnumKeyFromValue } from 'utils';\nimport { FormComponent } from 'components/Form/types';\nimport { generateMarks } from 'utils/material-ui';\nimport { PartialConfigFormItems, PowerUpIcons } from './types';\nimport { powerUpIconPack } from './icons';\n\nconst generateIconPackFromPowerUps = (iconStyle: React.CSSProperties) => {\n\treturn Object.values(PowerUp).reduce<PowerUpIcons>((acc, key) => {\n\t\tconst { icon: Icon, color } = powerUpIcons[key];\n\n\t\tacc[key] = {\n\t\t\ticon: <Icon style={iconStyle} />,\n\t\t\tcolor,\n\t\t};\n\n\t\treturn acc;\n\t}, {} as PowerUpIcons);\n};\nconst generatePowerUpSection = (\n\tname: string,\n\tmax: number,\n\tmovementStops?: Array<number>\n) => {\n\treturn Object.values(PowerUp).map(powerUp => {\n\t\tconst label = `${findEnumKeyFromValue(PowerUp, powerUp)}`;\n\t\treturn {\n\t\t\ttype: FormComponent.Rating,\n\t\t\tlabel: `${label} (number)`,\n\t\t\tname: `${name}.${powerUp}`,\n\t\t\tmax,\n\t\t\t...powerUpIconPack[powerUp],\n\t\t\t...(movementStops &&\n\t\t\t\tpowerUp === PowerUp.MovementSpeed && {\n\t\t\t\t\tlabel: `${label} (action interval, milliseconds)`,\n\t\t\t\t\ttype: FormComponent.Slider,\n\t\t\t\t\tstep: null,\n\t\t\t\t\tmin: Math.min(...movementStops),\n\t\t\t\t\tmax: Math.max(...movementStops),\n\t\t\t\t\tmarks: generateMarks(movementStops),\n\t\t\t\t}),\n\t\t};\n\t}) as PartialConfigFormItems;\n};\n\nexport { generateIconPackFromPowerUps, generatePowerUpSection };\n","import { SliderProps } from '@material-ui/core';\n\nfunction generateMarks(stops: Array<number>): SliderProps['marks'];\nfunction generateMarks(min: number, max: number): SliderProps['marks'];\nfunction generateMarks(\n\tminOrStops: number | Array<number>,\n\tmaxOrNull?: number | undefined\n): SliderProps['marks'] {\n\t// if it's an array\n\tif (Array.isArray(minOrStops)) {\n\t\treturn minOrStops.map(value => ({\n\t\t\tvalue,\n\t\t\tlabel: value,\n\t\t}));\n\t}\n\tconst diff = (maxOrNull as number) - minOrStops;\n\treturn Array(diff + 1)\n\t\t.fill(0)\n\t\t.map((_, ind) => {\n\t\t\tconst value = minOrStops + ind;\n\t\t\treturn {\n\t\t\t\tvalue,\n\t\t\t\t...((ind === 0 || ind === diff) && { label: value }),\n\t\t\t};\n\t\t});\n}\n\nexport { generateMarks };\n","import { useCallback, useEffect, useRef } from 'react';\n\ntype Callback = () => void;\n\n/**\n * setInterval hook.\n *\n * @see https://overreacted.io/making-setinterval-declarative-with-react-hooks/#just-show-me-the-code\n *\n * @param callback Method to call in each interval.\n * @param delay Delay for interval (in milliseconds).\n * @param shouldStop Some condition to trigger a stop on the interval.\n *\n * @returns stopper for the interval\n */\nconst useInterval = (\n\tcallback: Callback,\n\tdelay: number,\n\tshouldStop: boolean\n) => {\n\tconst savedCallback = useRef<Callback>();\n\tconst id = useRef<NodeJS.Timeout>();\n\n\t// Remember the latest callback.\n\tuseEffect(() => {\n\t\tsavedCallback.current = callback;\n\t}, [callback]);\n\n\tconst clearLastInterval = useCallback(() => {\n\t\tif (!id.current) return;\n\t\tclearInterval(id.current as NodeJS.Timeout);\n\t}, []);\n\n\tconst triggerCb = useCallback(() => {\n\t\tsavedCallback.current?.();\n\t}, []);\n\n\t// Set up the interval.\n\tuseEffect(() => {\n\t\tif (!shouldStop) id.current = setInterval(triggerCb, delay);\n\t\treturn () => clearLastInterval();\n\t}, [delay, shouldStop, clearLastInterval, triggerCb]);\n\n\t// Stop the interval if the stop is requested\n\tuseEffect(() => {\n\t\tif (shouldStop) clearLastInterval();\n\t}, [shouldStop, clearLastInterval]);\n\n\treturn clearLastInterval;\n};\n\nexport default useInterval;\n","import { useEffect, useRef } from 'react';\n\nconst usePrevious = (value: any) => {\n\tconst ref = useRef();\n\n\tuseEffect(() => {\n\t\tref.current = value;\n\t}, [value]);\n\n\treturn ref.current;\n};\n\nexport default usePrevious;\n","import {\n\tGameMap,\n\tNPCActionFn,\n\tPlayers,\n\tSquare,\n\tSquareCoordinates,\n} from 'containers/Game/types';\nimport { Direction, Player, PowerUp, Tile } from 'enums';\nimport { Bombs, GameConfig } from 'store/redux/reducers/game/types';\nimport {\n\tgetExplosionResults,\n\tgetPoweredUpValue,\n\tgetSquareCoordinatesFromSquareOrTopLeftCoordinates,\n\tisSquareOutOfBoundaries,\n} from './game';\nimport { getRandomInt } from './math';\n\n// allow debugging in prod\n// @ts-ignore\nwindow.NPC_DEBUG = false;\nconst log = (value: any, label = '') => {\n\t// @ts-ignore\n\tif (!window.NPC_DEBUG) return;\n\tconsole.log(...[label, value].filter(Boolean));\n};\n\ntype NpcStore = {\n\tid: number;\n\tparentNodes: MovementNode[];\n\tlastBombTime: number;\n\tdropBomb: () => void;\n\tgameMap: GameMap;\n\tplayers: Players;\n\tbombs: Bombs;\n\tpowerUpConfig: GameConfig['powerUps'];\n\tsizes: GameConfig['sizes'];\n\tbombDuration: GameConfig['duration']['bomb'];\n} | null;\nlet Store: NpcStore;\n\ntype Score = number | undefined;\n\nenum NPCScore {\n\tIsDanger = -10000,\n\tIsNonBreakingTile = -100,\n\tIsNonAdjacentNonBreakingTile = -5,\n\tIsStuck = 0,\n\tIsEmptyTile = 2,\n\tIsBreakingTile = 3,\n\tIsPlayer = 4,\n\t/** If the current and the next spots are fire, we need to get out */\n\tIsPossibleFireExit = 1,\n\tIsPowerUp = 1000,\n}\n\ntype MovementNode = {\n\tscore: Score;\n\tparentId: number | null;\n\thasChildren: boolean;\n\tdirection: Direction;\n\tlevel: number;\n};\n\ntype MovementNodeWithKey = {\n\t[key: number]: MovementNode;\n};\n\nconst isDifferentSquare = (\n\tnewCoordinates: SquareCoordinates,\n\toldCoordinates: SquareCoordinates\n) => {\n\tconst { ySquare: newYSquare, xSquare: newXSquare } = newCoordinates;\n\tconst { ySquare: oldYSquare, xSquare: oldXSquare } = oldCoordinates;\n\n\treturn newYSquare !== oldYSquare || newXSquare !== oldXSquare;\n};\n\nconst isSquareAPlayer = (square: Square) => {\n\treturn Object.values<Square>(Player).includes(square);\n};\n\nconst isSquareAPossibleFire = (currentSquareCoordinates: SquareCoordinates) => {\n\tconst bombs = Object.values(Store!.bombs);\n\tif (!bombs.length) return false;\n\n\tconst _fireCoordinates: Array<SquareCoordinates> = [];\n\n\tbombs.forEach(({ playerId, top, left }) => {\n\t\tconst { players } = Store!;\n\t\tconst { coordinatesToSetOnFire } = getExplosionResults(\n\t\t\tStore!.gameMap,\n\t\t\t{ top, left },\n\t\t\tplayers[playerId]?.state\n\t\t\t\t? getPoweredUpValue(\n\t\t\t\t\t\tplayers[playerId]!.state,\n\t\t\t\t\t\tPowerUp.BombSize,\n\t\t\t\t\t\tStore!.powerUpConfig\n\t\t\t\t  )\n\t\t\t\t: Store!.powerUpConfig.defaults[PowerUp.BombSize],\n\t\t\tStore!.sizes\n\t\t);\n\t\tObject.values(coordinatesToSetOnFire)\n\t\t\t.flat()\n\t\t\t.forEach(squareCoordinates => {\n\t\t\t\t_fireCoordinates.push(squareCoordinates);\n\t\t\t});\n\t});\n\n\treturn (\n\t\t_fireCoordinates.findIndex(fireSquareCoordinates => {\n\t\t\treturn !isDifferentSquare(\n\t\t\t\tfireSquareCoordinates,\n\t\t\t\tcurrentSquareCoordinates\n\t\t\t);\n\t\t}) >= 0\n\t);\n};\n\nconst isAdjacent = (\n\t{ ySquare: newYSquare, xSquare: newXSquare }: SquareCoordinates,\n\t{ ySquare: oldYSquare, xSquare: oldXSquare }: SquareCoordinates\n) => {\n\treturn (\n\t\t// Directly top or below. If left coordinate is the same and it is +-1 top coordinate\n\t\t// Place a bomb\n\t\t(newXSquare === oldXSquare &&\n\t\t\t(newYSquare === oldYSquare + 1 || newYSquare === oldYSquare - 1)) ||\n\t\t// directly left or right. Same idea as above but for +1 left coordinate\n\t\t(newYSquare === oldYSquare &&\n\t\t\t(newXSquare === oldXSquare + 1 || newXSquare === oldXSquare - 1))\n\t);\n};\n\nconst dropBombAndRunOrScoreTarget = (\n\tnewCoordinates: SquareCoordinates,\n\toldCoordinates: SquareCoordinates,\n\ttargetScore: Score,\n\trunScore?: -100\n) => {\n\t// TODO: is this necessary? it's already the nextSquare\n\tif (isAdjacent(newCoordinates, oldCoordinates)) {\n\t\t// TODO: move this up to usePlayerEvents\n\t\tconst currentTime = new Date().getTime();\n\t\tif (\n\t\t\tStore!.lastBombTime <=\n\t\t\tcurrentTime -\n\t\t\t\tObject.values(Store!.bombDuration).reduce(\n\t\t\t\t\t(acc, duration) => acc + duration,\n\t\t\t\t\t0\n\t\t\t\t) *\n\t\t\t\t\t1000\n\t\t) {\n\t\t\tStore!.dropBomb();\n\t\t\tStore!.lastBombTime = currentTime;\n\t\t}\n\t\treturn runScore;\n\t}\n\tif (isDifferentSquare(newCoordinates, oldCoordinates)) {\n\t\treturn targetScore;\n\t}\n\n\treturn null;\n};\n\nconst generateScore = (\n\tnewCoordinates: SquareCoordinates,\n\toldCoordinates: SquareCoordinates,\n\tlevel: number\n): number | undefined => {\n\tconst { ySquare: newYSquare, xSquare: newXSquare } = newCoordinates;\n\n\tif (isSquareOutOfBoundaries(newCoordinates, Store!.sizes.map)) {\n\t\treturn undefined;\n\t}\n\n\tconst newSquare = Store!.gameMap[newYSquare][newXSquare];\n\t// TODO: Please comment\n\tif (isSquareAPossibleFire(newCoordinates)) {\n\t\tif (isSquareAPossibleFire(oldCoordinates)) {\n\t\t\treturn NPCScore.IsPossibleFireExit;\n\t\t}\n\t\treturn NPCScore.IsDanger;\n\t}\n\tif (Object.values(PowerUp).includes(newSquare as PowerUp)) {\n\t\treturn NPCScore.IsPowerUp * level;\n\t}\n\tif (!isDifferentSquare(newCoordinates, oldCoordinates)) {\n\t\treturn NPCScore.IsStuck;\n\t}\n\tif (newSquare === Tile.Empty) {\n\t\treturn NPCScore.IsEmptyTile;\n\t}\n\tif (isSquareAPlayer(newSquare)) {\n\t\tconst score = dropBombAndRunOrScoreTarget(\n\t\t\tnewCoordinates,\n\t\t\toldCoordinates,\n\t\t\tNPCScore.IsPlayer\n\t\t);\n\t\tif (score !== null) return score;\n\t}\n\tif (newSquare === Tile.Breaking) {\n\t\tif (isSquareAPossibleFire(oldCoordinates)) {\n\t\t\treturn NPCScore.IsDanger;\n\t\t}\n\t\tconst score = dropBombAndRunOrScoreTarget(\n\t\t\tnewCoordinates,\n\t\t\toldCoordinates,\n\t\t\tNPCScore.IsBreakingTile\n\t\t);\n\t\tif (score !== null) return score;\n\t}\n\tif (newSquare === Tile.NonBreaking) {\n\t\t// TODO: is this necessary? it's already the nextSquare\n\t\tif (isAdjacent(newCoordinates, oldCoordinates)) {\n\t\t\treturn NPCScore.IsNonBreakingTile;\n\t\t}\n\t\treturn NPCScore.IsNonAdjacentNonBreakingTile;\n\t}\n\n\treturn NPCScore.IsStuck;\n};\n\nconst generateMovementTree = (\n\tnewCoordinates: SquareCoordinates,\n\toldCoordinates: SquareCoordinates,\n\tlevel: number = 1,\n\tparentId: number | null = null\n) => {\n\tconst { ySquare: newYSquare, xSquare: newXSquare } = newCoordinates;\n\tlet playerMovementTree: MovementNodeWithKey = {};\n\n\tObject.values(Direction).forEach(direction => {\n\t\tlet _newYSquare = newYSquare;\n\t\tlet _newXSquare = newXSquare;\n\n\t\tStore!.id++;\n\n\t\tswitch (direction) {\n\t\t\tcase Direction.LEFT:\n\t\t\t\t_newXSquare--;\n\t\t\t\tbreak;\n\t\t\tcase Direction.UP:\n\t\t\t\t_newYSquare--;\n\t\t\t\tbreak;\n\t\t\tcase Direction.RIGHT:\n\t\t\t\t_newXSquare++;\n\t\t\t\tbreak;\n\t\t\tcase Direction.DOWN:\n\t\t\t\t_newYSquare++;\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tbreak;\n\t\t}\n\t\tconst score = generateScore(\n\t\t\t{ ySquare: _newYSquare, xSquare: _newXSquare },\n\t\t\toldCoordinates,\n\t\t\tlevel\n\t\t);\n\n\t\tplayerMovementTree[Store!.id] = {\n\t\t\tscore,\n\t\t\thasChildren: level > 0 && score !== undefined,\n\t\t\tparentId,\n\t\t\tdirection,\n\t\t\tlevel,\n\t\t};\n\t\tif (level > 0 && !!score) {\n\t\t\tplayerMovementTree = {\n\t\t\t\t...playerMovementTree,\n\t\t\t\t...generateMovementTree(\n\t\t\t\t\t{ ySquare: _newYSquare, xSquare: _newXSquare },\n\t\t\t\t\toldCoordinates,\n\t\t\t\t\tlevel - 1,\n\t\t\t\t\tStore!.id\n\t\t\t\t),\n\t\t\t};\n\t\t}\n\t});\n\n\treturn playerMovementTree!;\n};\n\nconst findNodeWithHighestScore = (movementNodes: MovementNode[]) => {\n\treturn movementNodes.reduce((acc, current) => {\n\t\tlet retVal = current;\n\t\tif (current.score === undefined) {\n\t\t\tretVal = acc;\n\t\t}\n\t\tif (acc.score! > current.score!) {\n\t\t\tretVal = acc;\n\t\t}\n\t\tif (acc.score! < current.score!) {\n\t\t\tretVal = current;\n\t\t}\n\t\tif (acc.score === current.score) {\n\t\t\tconst randomInt = getRandomInt(2);\n\t\t\tretVal = randomInt === 0 ? current : acc;\n\t\t}\n\n\t\treturn retVal;\n\t});\n};\n\nconst groupMovementNodesByParentId = (movementNodes: MovementNode[]) => {\n\tconst movementNodesGroupedById: { [key: number]: MovementNode[] } = {};\n\n\tmovementNodes.forEach(movementNode => {\n\t\tconst movementNodeParentId = movementNode.parentId!;\n\t\tif (movementNodesGroupedById[movementNodeParentId]) {\n\t\t\tmovementNodesGroupedById[movementNodeParentId].push(movementNode);\n\t\t} else {\n\t\t\tmovementNodesGroupedById[movementNodeParentId] = [movementNode];\n\t\t}\n\t});\n\treturn movementNodesGroupedById;\n};\n\nconst getTotalScoreOfAllNodes = (\n\tmovementTree: MovementNodeWithKey,\n\tparentId: number | undefined | null = undefined\n) => {\n\tlet validMovementNodes: MovementNode[];\n\n\tif (parentId !== null) {\n\t\tif (parentId === undefined) {\n\t\t\tvalidMovementNodes = Object.values(movementTree).filter(\n\t\t\t\tmovementNode => !movementNode.hasChildren\n\t\t\t);\n\t\t} else {\n\t\t\tvalidMovementNodes = Object.values(movementTree).filter(\n\t\t\t\tmovementNode =>\n\t\t\t\t\tmovementNode.parentId === movementTree[parentId!].parentId\n\t\t\t);\n\t\t}\n\n\t\tconst movementNodesGroupedByParentId = groupMovementNodesByParentId(\n\t\t\tvalidMovementNodes!\n\t\t);\n\n\t\tObject.entries(movementNodesGroupedByParentId).forEach(\n\t\t\t([groupParentId, movementNodes]) => {\n\t\t\t\tconst _groupParentId =\n\t\t\t\t\tgroupParentId === 'null' ? null : Number(groupParentId);\n\n\t\t\t\tconst nodeWithHighestScore = findNodeWithHighestScore(\n\t\t\t\t\tmovementNodes!\n\t\t\t\t);\n\n\t\t\t\tif (!_groupParentId) {\n\t\t\t\t\tif (\n\t\t\t\t\t\t!Store!.parentNodes.some(\n\t\t\t\t\t\t\tparentNode =>\n\t\t\t\t\t\t\t\tparentNode.direction ===\n\t\t\t\t\t\t\t\tnodeWithHighestScore.direction\n\t\t\t\t\t\t)\n\t\t\t\t\t) {\n\t\t\t\t\t\tStore!.parentNodes.push(nodeWithHighestScore);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\t// eslint-disable-next-line no-param-reassign\n\t\t\t\t\tmovementTree[_groupParentId].score =\n\t\t\t\t\t\tmovementTree[_groupParentId].score! +\n\t\t\t\t\t\t(nodeWithHighestScore.score!\n\t\t\t\t\t\t\t? nodeWithHighestScore.score\n\t\t\t\t\t\t\t: 0);\n\t\t\t\t\tgetTotalScoreOfAllNodes(movementTree, _groupParentId);\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t}\n};\n\nconst findBestMove = (\n\tcurrentCoordinates: SquareCoordinates\n): MovementNode | null => {\n\tStore!.id = 0;\n\tStore!.parentNodes = [];\n\n\tconst movementTree = generateMovementTree(\n\t\tcurrentCoordinates,\n\t\tcurrentCoordinates,\n\t\tundefined\n\t);\n\tlog(currentCoordinates, 'currentCoordinates');\n\tlog(movementTree, 'originalMoves');\n\tgetTotalScoreOfAllNodes(movementTree);\n\tlog(movementTree, 'scoredMoves');\n\n\treturn findNodeWithHighestScore(Store!.parentNodes);\n};\n\nconst npcAction: NPCActionFn = ({\n\tplayerId,\n\tplayers,\n\tgameMap,\n\tbombs,\n\ttriggerMove,\n\tdropBomb,\n\tref,\n\tpowerUpConfig,\n\tsizes,\n\tbombDuration,\n}) => {\n\tconst currentPlayer = players[playerId];\n\tStore = {\n\t\tid: 0,\n\t\tparentNodes: [],\n\t\tlastBombTime: 0,\n\t\tdropBomb: () => dropBomb(playerId),\n\t\tgameMap,\n\t\tbombs,\n\t\tplayers,\n\t\tpowerUpConfig,\n\t\tsizes,\n\t\tbombDuration,\n\t};\n\n\tif (!currentPlayer) return;\n\n\t// eslint-disable-next-line max-len\n\tconst currentSquareCoordinates = getSquareCoordinatesFromSquareOrTopLeftCoordinates(\n\t\tcurrentPlayer.coordinates,\n\t\tsizes.movement\n\t);\n\n\tconst bestMovementNode = findBestMove(currentSquareCoordinates);\n\tlog(bestMovementNode, 'bestMovementNode');\n\n\tif ((bestMovementNode?.score || 0) > 0) {\n\t\ttriggerMove({ playerId, direction: bestMovementNode!.direction, ref });\n\t}\n};\n\nexport { npcAction };\n","import {\n\tGameApi,\n\tKeyboardConfig,\n\tKeyboardEventCode,\n\tKeyMap,\n\tNonNullablePlayerRef,\n\tOnDropBomb,\n\tPlayerId,\n\tPlayers,\n} from 'containers/Game/types';\nimport { GameType, PowerUp } from 'enums';\nimport { useEffect, useMemo, useRef } from 'react';\nimport {\n\tgetMoveDirectionFromKeyMap,\n\tgetPoweredUpValue,\n\tisPlayerDead,\n\tmapAllPossibleKeyboardKeysForAction,\n} from 'utils/game';\nimport { npcAction } from 'utils/npc';\nimport useInterval from 'hooks/useInterval';\nimport usePrevious from 'hooks/usePrevious';\nimport { CODE_SPACE } from 'keycode-js';\nimport { GameConfig, OnTriggerMove, TriggerMove } from '../reducers/game/types';\n\ntype HandleActionsFn = (playerId: PlayerId) => void;\ntype KeyDownAction = (playerId: PlayerId, keys: KeyboardConfig) => void;\n\ntype KeyAction = (keyEventCode: KeyboardEventCode) => void;\n\nconst usePlayerRefs = () => {\n\tconst playerRefs = useRef<{ [key in PlayerId]?: HTMLElement | null }>({\n\t\tP1: document.getElementById('P1'),\n\t\tP2: document.getElementById('P2'),\n\t\tP3: document.getElementById('P3'),\n\t\tP4: document.getElementById('P4'),\n\t});\n\n\tconst recalculate = () => {\n\t\tObject.keys(playerRefs.current).forEach(playerId => {\n\t\t\tplayerRefs.current[playerId as PlayerId] = document.getElementById(\n\t\t\t\tplayerId\n\t\t\t);\n\t\t});\n\t};\n\n\treturn { playerRefs, recalculate };\n};\n\nconst useTimeOutRef = () => {\n\tconst timeOutRef = useRef<Record<PlayerId, number>>({\n\t\tP1: new Date().getTime(),\n\t\tP2: new Date().getTime(),\n\t\tP3: new Date().getTime(),\n\t\tP4: new Date().getTime(),\n\t});\n\n\treturn timeOutRef;\n};\n\nconst useCanMove = (\n\tplayers: Players,\n\tpowerUpConfig: GameConfig['powerUps']\n) => {\n\tconst timeOutRef = useTimeOutRef();\n\tconst canMove = (playerId: PlayerId) => {\n\t\tconst npc = players[playerId];\n\t\tif (!npc) return false;\n\t\tconst { state: npcState } = npc;\n\t\tconst newTime = new Date().getTime();\n\t\tconst movementSpeed = getPoweredUpValue(\n\t\t\tnpcState,\n\t\t\tPowerUp.MovementSpeed,\n\t\t\tpowerUpConfig\n\t\t);\n\t\tif (newTime - timeOutRef.current[playerId]! > movementSpeed) {\n\t\t\ttimeOutRef.current[playerId] = newTime;\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t};\n\n\treturn canMove;\n};\n\nconst useEvents = ({\n\ttriggerMove,\n\tplayers,\n\ttimeOutRef,\n\tkeyMap,\n\tis3D,\n\tpowerUpConfig,\n}: {\n\ttriggerMove: OnTriggerMove;\n\tplayers: Players;\n\tkeyMap: React.MutableRefObject<KeyMap>;\n\ttimeOutRef: React.MutableRefObject<Record<PlayerId, number>>;\n\tis3D: boolean;\n\tpowerUpConfig: GameConfig['powerUps'];\n}) => {\n\tconst { playerRefs, recalculate } = usePlayerRefs();\n\tconst previousIs3D = usePrevious(is3D);\n\n\tuseEffect(() => {\n\t\tif (previousIs3D === is3D) return;\n\t\trecalculate();\n\t}, [is3D, previousIs3D, recalculate]);\n\n\tconst canMove = useCanMove(players, powerUpConfig);\n\n\tconst move: KeyDownAction = (playerId, playerKeyboardConfig) => {\n\t\tconst directions = getMoveDirectionFromKeyMap(\n\t\t\tkeyMap,\n\t\t\tplayerKeyboardConfig\n\t\t);\n\t\tif (!directions.length) return;\n\n\t\tdirections.forEach(direction => {\n\t\t\ttriggerMove({\n\t\t\t\tplayerId,\n\t\t\t\tdirection,\n\t\t\t\tref: playerRefs.current[playerId] as NonNullablePlayerRef,\n\t\t\t});\n\t\t});\n\t};\n\n\tconst handleActions = (playerId: PlayerId) => {\n\t\tif (!keyMap.current) return;\n\t\tif (!timeOutRef.current) return;\n\t\t// don't do anything if no key is being pressed\n\t\tif (!Object.values(keyMap.current).filter(Boolean).length) return;\n\n\t\tconst { keyboardConfig } = players[playerId]!;\n\t\tif (!keyboardConfig || !Object.keys(keyboardConfig).length) return;\n\n\t\tconst ref = playerRefs.current[playerId];\n\t\tif (!ref) {\n\t\t\tplayerRefs.current[playerId] = document.getElementById(playerId);\n\t\t}\n\n\t\tif (ref && canMove(playerId)) move(playerId, keyboardConfig);\n\t};\n\n\treturn { move, handleActions };\n};\n\nconst useKeyboardEvent = ({\n\tonKeyDown,\n\tonKeyUp,\n}: {\n\tonKeyDown?: KeyAction;\n\tonKeyUp?: KeyAction;\n} = {}) => {\n\tconst keyMap = useRef<KeyMap>({});\n\n\tuseEffect(() => {\n\t\tconst registerKeys = (e: KeyboardEvent, isKeyDown: boolean) => {\n\t\t\t/** @see https://stackoverflow.com/questions/5203407/how-to-detect-if-multiple-keys-are-pressed-at-once-using-javascript#answer-12444641 */\n\t\t\tkeyMap.current[e.code as KeyboardEventCode] = isKeyDown;\n\t\t};\n\n\t\tconst handleKeyEvent = (e: KeyboardEvent) => {\n\t\t\tif (!keyMap.current) return;\n\n\t\t\tconst isKeyDown = e.type === 'keydown';\n\t\t\tif (e.code === CODE_SPACE) e.preventDefault();\n\t\t\tregisterKeys(e, isKeyDown);\n\t\t\tif (isKeyDown) onKeyDown?.(e.code as KeyboardEventCode);\n\t\t\telse onKeyUp?.(e.code as KeyboardEventCode);\n\t\t};\n\n\t\twindow.addEventListener('keyup', handleKeyEvent);\n\t\twindow.addEventListener('keydown', handleKeyEvent);\n\n\t\treturn () => {\n\t\t\twindow.removeEventListener('keyup', handleKeyEvent);\n\t\t\twindow.removeEventListener('keydown', handleKeyEvent);\n\t\t};\n\t}, [onKeyDown, onKeyUp]);\n\n\treturn keyMap;\n};\n\nconst usePlayerActionSpeed = (\n\tplayers: Players,\n\tplayerId: PlayerId,\n\tpowerUpConfig: GameConfig['powerUps']\n) => {\n\tconst movementSpeed = useMemo(() => {\n\t\tconst playerState = players[playerId]?.state;\n\t\t// if there is no NPC, lets not call this often\n\t\tif (!playerState) return null;\n\t\treturn getPoweredUpValue(\n\t\t\tplayerState,\n\t\t\tPowerUp.MovementSpeed,\n\t\t\tpowerUpConfig\n\t\t);\n\t}, [playerId, players, powerUpConfig]);\n\n\treturn movementSpeed;\n};\n\nconst canPlayerTakeAction = (\n\tplayers: Players,\n\tplayerId: PlayerId,\n\tpowerUpConfig: GameConfig['powerUps']\n) => {\n\tconst player = players[playerId];\n\t// player doesn't exist\n\tif (!player) return false;\n\t// player is dead\n\tif (isPlayerDead(player.state, powerUpConfig)) return false;\n\n\treturn true;\n};\n\nconst usePlayerInterval = (\n\tplayers: Players,\n\tplayerId: PlayerId,\n\tpowerUpConfig: GameConfig['powerUps'],\n\tcb: HandleActionsFn\n) => {\n\tconst playerActionSpeedOrNull = usePlayerActionSpeed(\n\t\tplayers,\n\t\tplayerId,\n\t\tpowerUpConfig\n\t);\n\n\tuseInterval(\n\t\t() => {\n\t\t\tif (!canPlayerTakeAction(players, playerId, powerUpConfig)) return;\n\t\t\tcb(playerId);\n\t\t},\n\t\tplayerActionSpeedOrNull || Number.MAX_SAFE_INTEGER,\n\t\t!playerActionSpeedOrNull\n\t);\n};\n\nconst handleBombForPlayers = (\n\tplayers: Players,\n\tdropBomb: OnDropBomb,\n\tpowerUpConfig: GameConfig['powerUps']\n) => (keyEventCode: KeyboardEventCode) => {\n\t(Object.keys(players) as Array<PlayerId>).forEach(playerId => {\n\t\tif (canPlayerTakeAction(players, playerId, powerUpConfig)) {\n\t\t\tconst { keyboardConfig } = players[playerId]!;\n\t\t\tif (keyboardConfig) {\n\t\t\t\t// let isKeyPressed = false;\n\t\t\t\tconst bombKeys = mapAllPossibleKeyboardKeysForAction(\n\t\t\t\t\tkeyboardConfig,\n\t\t\t\t\t'DropBomb'\n\t\t\t\t);\n\t\t\t\tif (bombKeys.includes(keyEventCode)) {\n\t\t\t\t\tdropBomb(playerId);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t});\n};\n\nconst IntervalWrapper = ({\n\tplayerId,\n\tplayers,\n\tpowerUpConfig,\n\tcb,\n}: {\n\tplayerId: PlayerId;\n\tplayers: Players;\n\tpowerUpConfig: GameConfig['powerUps'];\n\tcb: HandleActionsFn;\n}) => {\n\tusePlayerInterval(players, playerId, powerUpConfig, cb);\n\treturn null;\n};\n\nconst usePlayerEvents = ({\n\tstate,\n\tprovider,\n\ttype: gameType,\n\tplayerId,\n}: GameApi) => {\n\tconst { dropBomb, triggerMove } = provider;\n\tconst {\n\t\tgameMap,\n\t\tbombs,\n\t\tplayers,\n\t\tis3D,\n\t\tconfig: {\n\t\t\tpowerUps: powerUpConfig,\n\t\t\tsizes,\n\t\t\tduration: { bomb: bombDuration },\n\t\t},\n\t} = state;\n\n\tconst { playerRefs } = usePlayerRefs();\n\n\tconst _players = useMemo<Players>(() => {\n\t\treturn gameType === GameType.Local\n\t\t\t? players\n\t\t\t: { [playerId!]: players[playerId!] };\n\t\t// none of the deps will affect this\n\t\t// eslint-disable-next-line react-hooks/exhaustive-deps\n\t}, [players]);\n\t// }, [gameType, playerId, players]);\n\n\tconst keyMap = useKeyboardEvent({\n\t\tonKeyDown: handleBombForPlayers(_players, dropBomb, powerUpConfig),\n\t});\n\tconst timeOutRef = useTimeOutRef();\n\tconst { handleActions } = useEvents({\n\t\ttriggerMove,\n\t\tplayers: _players,\n\t\ttimeOutRef,\n\t\tkeyMap,\n\t\tis3D,\n\t\tpowerUpConfig,\n\t});\n\n\tconst canMove = useCanMove(players, powerUpConfig);\n\n\tconst handleNpcActions = (pId: PlayerId) => {\n\t\tconst ref = playerRefs.current[pId];\n\n\t\tif (!ref) {\n\t\t\tplayerRefs.current[pId] = document.getElementById(pId);\n\t\t}\n\n\t\tnpcAction({\n\t\t\tplayerId: pId,\n\t\t\tdropBomb,\n\t\t\tgameMap,\n\t\t\tbombs,\n\t\t\tplayers: _players,\n\t\t\ttriggerMove: (props: TriggerMove) => {\n\t\t\t\tif (canMove(pId)) triggerMove(props);\n\t\t\t},\n\t\t\tref: playerRefs.current[pId] as NonNullablePlayerRef,\n\t\t\tpowerUpConfig,\n\t\t\tsizes,\n\t\t\tbombDuration,\n\t\t});\n\t};\n\n\t// URGENT: Since this triggers a move event, if the\n\t// player is on the same explosion fire, he dies\n\t// multiple times\n\t// TODO: In the next update, start these intervals\n\t// when the keys are pressed and not continuously\n\treturn Object.keys(_players).map(pId => {\n\t\t// TODO: online game can also have NPCs, have a check for that\n\t\tconst { isNPC } = _players[pId as PlayerId]!;\n\t\treturn (\n\t\t\t<IntervalWrapper\n\t\t\t\tkey={pId}\n\t\t\t\tplayerId={pId as PlayerId}\n\t\t\t\tplayers={_players}\n\t\t\t\tpowerUpConfig={powerUpConfig}\n\t\t\t\tcb={isNPC ? handleNpcActions : handleActions}\n\t\t\t/>\n\t\t);\n\t});\n};\n\nexport { useKeyboardEvent };\nexport default usePlayerEvents;\n","import styled from 'styled-components';\n\nconst Container = styled.div`\n\twidth: 100%;\n\tdisplay: flex;\n\tjustify-content: center;\n\talign-items: center;\n\tflex-wrap: wrap;\n`;\n\nexport default Container;\n"],"sourceRoot":""}